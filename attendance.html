<!DOCTYPE html>
<html>
<body>

<h3>Attendance</h3>

<button onclick="start()">Mark Attendance</button>

<div id="reader"></div>

<script src="https://unpkg.com/html5-qrcode"></script>

<script>

const SITE_LAT = 19.0760;
const SITE_LNG = 72.8777;

const SCRIPT = "https://script.google.com/macros/s/AKfycbx5IHPAfFIEH4dvVVBB3V-0J07DAY2FJqMwQQ2JH9pM4QU_c2kiEOdXM8x27dSrwdqESA/exec";

function start(){

navigator.geolocation.getCurrentPosition(pos=>{

const lat = pos.coords.latitude;
const lng = pos.coords.longitude;

const qr = new Html5Qrcode("reader");

qr.start(
{ facingMode: "environment" },
{ fps:10, qrbox:250 },
code=>{

qr.stop();

if(dist(lat,lng) > 0.1){
alert("Not at location");
return;
}

fetch(`${SCRIPT}?name=${localStorage.guard}&code=${code}&lat=${lat}&lng=${lng}`)
.then(r=>r.text())
.then(t=>{
document.body.innerHTML = "<h2>"+t+"</h2>";
});

}
);

});

}

function dist(a,b){
return Math.sqrt((a-SITE_LAT)**2 + (b-SITE_LNG)**2);
}

</script>

</body>
</html>
