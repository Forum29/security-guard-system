<!DOCTYPE html>
<html>
<body>

<h3>Attendance</h3>

<button onclick="start()">Mark Attendance</button>

<div id="reader"></div>

<script src="https://unpkg.com/html5-qrcode"></script>

<script>

let submitted=false;

const SCRIPT="https://script.google.com/macros/s/AKfycbzsdn-hSwfiOgal8ilJXnMUBkIrcYOFeiUZOlunN4Xoj3WJVennpQBNMkuWxSKQJdVbWQ/exec";

function start(){

submitted=false;

const qr=new Html5Qrcode("reader");

qr.start(
{facingMode:"environment"},
{fps:10,qrbox:250},
code=>{

if(submitted) return;
submitted=true;

qr.stop();

fetch(`${SCRIPT}?name=${localStorage.guard}&code=${code}`)
.then(r=>r.text())
.then(t=>{
document.body.innerHTML="<h2>"+t+"</h2>";
});

}
);

}

</script>

</body>
</html>
